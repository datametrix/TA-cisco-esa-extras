# TODO: Check if this can be done with Custom Log Action instead of creating a transaction
[Summary - Cisco ESA Email Summary]
alert.digest_mode = True
alert.suppress = 0
alert.track = 0
auto_summarize.dispatch.earliest_time = -1d@h
cron_schedule = */5 * * * *
description = Email Summary for Cisco ESA
dispatch.earliest_time = -10m
dispatch.latest_time = -5m
enableSched = 1
search = sourcetype="cisco:esa:textmail" NOT "Custom Log Entry" | transaction internal_message_id dcid icid | stats first(_time) AS _time first(sender) AS sender values(dest) AS dest values(file_name) AS file_name first(message_id) AS message_id first(dest) AS orig_dest values(recipient) AS orig_recipient first(src) AS orig_src first(message_size) AS size first(message_subject) AS subject values(action) AS action BY internal_message_id | eval src=orig_src | rex field=orig_recipient "(?<recipient_username>[^@]+)@(?<recipient_domain>[^\s]*)" | rex field=sender "(?<sender_username>[^@]+)@(?<sender_domain>[^\s]*)" | eval src_user=sender_username | search action=* | collect addtime=true sourcetype=cisco:esa:email:summary
